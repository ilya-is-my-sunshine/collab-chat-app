<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="sign_up_style.css">
    <title>Sign Up for Connectaru</title>
</head>
<body>
      <div class="container">
        <div class="box form-box" id='main-form'>
            <header>Create a new account</header>
            <form action="" method="post" id='sign_up'>
                <div class="field input">
                    <label for="username">Username</label>
                    <input 
					required
					minlength="3"
					custommaxlength="20"
					type="text" 
					name="username" 
					id="username" 
					autocomplete="off"
					/>
					<span style="color: red;" class="error"></span>
					<span class="error-icon"></span>
					<span class="success-icon"></span>
                </div>

                <div class="field input">
                    <label for="password">Password</label>
                    <input 
					required
					minlength="1"
					type="password" 
					name="password"
					id="password" 
					autocomplete="off" 
					/>
					<span style="color: red;" class="error"></span>
					<span class="error-icon"></span>
					<span class="success-icon"></span>
                </div>

				<div class="field input">
                    <label for="confirm_Password">Confirm Password</label>
                    <input 
					required
					minlength="1"
					type="password" 
					name="confirm_password"
					id="confirm_password" 
					match="password"
					autocomplete="off" 
					/>
					<span style="color: red;" class="error"></span>
					<span class="error-icon"></span>
					<span class="success-icon"></span>
                </div>

				<div class="field input">
                    <label for="Security_Question">Security Question</label>
					<select name="Security_Question" id="Security_Question" required>
						<option value="" disabled selected>Select Security Question</option>
						<option value="1">Where is your hometown?</option>
						<option value="2">What is your pet's name?</option>
						<option value="3">Who is your favorite anime character?</option>
					</select>
                </div>
				<div class="field input">
                    <label for="Security_Answer">Security Answer</label>
                    <input 
					required
					minlength="1"
					type="text" 
					name="Security_Answer"
					id="Security_Answer" 
					autocomplete="off" 
					/>
					<span style="color: red;" class="error"></span>
					<span class="error-icon"></span>
					<span class="success-icon"></span>
                </div>
                <div class="field">
                    <input type="submit" class="btn" name="submit" value="Sign Up" required>
                </div>  
				<a href="login.html">Already have an account?</a>
            </form>
        </div>
      </div>
</body>
</html>
<script>
        const validateForm = (formSelector, callback) => {
	
	const formElement = document.querySelector(formSelector);
	
	const validationOptions = [
		{
			attribute: 'minlength',
			isValid: input => input.value && input.value.length >= parseInt(input.minLength, 10),
			errorMessage: (input, label) => `${label.textContent} needs to be at least ${input.minLength} characters`
		},
		{
			attribute: 'custommaxlength',
			isValid: input => input.value && input.value.length <= parseInt(input.getAttribute('custommaxlength'), 10),
			errorMessage: (input, label) => `${label.textContent} needs to be less than ${input.getAttribute('custommaxlength')} characters`
		},
		{
			attribute: 'pattern',
			isValid: input => {
				const patternRegex = new RegExp(input.pattern);
				return patternRegex.test(input.value);
			},
			errorMessage: (input, label) => `Not a valid ${label.textContent}`,
		},
		{
			attribute: 'match',
			isValid: input => {
				const matchSelector = input.getAttribute('match');
				const matchedElement = formElement.querySelector(`#${matchSelector}`);
				return matchedElement && matchedElement.value.trim() === input.value.trim();
			},
			errorMessage: (input, label) => {
				const matchSelector = input.getAttribute('match');
				const matchedElement = formElement.querySelector(`#${matchSelector}`);
				//return `${label.textContent} should match password`;
				return `passwords should match`;
			},
		},
		{
			attribute: 'required',
			isValid: input => input.value.trim() != '',
			errorMessage: (input, label) => `${label.textContent} is required`
		}
		
	];

	const validateSingleFormGroup = formGroup => {
		const label = formGroup.querySelector('label');
		const input = formGroup.querySelector('input, textarea');
		const errorContainer = formGroup.querySelector('.error');
		const errorIcon = formGroup.querySelector('.error-icon');
		const successIcon = formGroup.querySelector('.success-icon');
		let formGroupError = false;
		for(const option of validationOptions){
			if(input.hasAttribute(option.attribute) && !option.isValid(input)){
				errorContainer.textContent = option.errorMessage(input, label);
				input.classList.add('border-red-700');
				input.classList.remove('border-green-700');
				successIcon.classList.add('hidden');
				errorIcon.classList.remove('hidden');
				formGroupError = true;
			}
		}
		
		if (!formGroupError){
			errorContainer.textContent = "";
			successIcon.classList.remove('hidden');
			errorIcon.classList.add('hidden');
			input.classList.add('border-green-700');
			input.classList.remove('border-red-700');
		}
		
		return !formGroupError;
	};
	
	formElement.setAttribute('novalidate', '');
	
	Array.from(formElement.elements).forEach(element => {
		element.addEventListener('blur', event => {
			const field_input = event.srcElement.parentElement;
			if (field_input.classList.contains('field') && field_input.classList.contains('input')) {
				validateSingleFormGroup(field_input);
			}
		});
	});
	
	const validateAllFormGroups = formToValidate => {
		const formGroups = Array.from(
			formToValidate.querySelectorAll('.field.input')
		);
		return formGroups.every(formGroup => validateSingleFormGroup(formGroup));	
	};
	
	formElement.addEventListener('submit', (event) => {
		const formValid = validateAllFormGroups(formElement);
		if(!formValid){
			event.preventDefault();
		} else {
			console.log('Form is valid');
			//event.preventDefault();
			//callback(formElement);
		}
	});
};
const sendToServer ="";
validateForm('#sign_up', sendToServer);
</script>